<div class="h-page" [class.modal-open]="expandedLane">
  <header class="h-top glass">
    <div class="h-brand">
      <div class="h-title">Dashboard</div>
      <div class="h-sub">
        Mood: <b>{{ moodLabel(todayMood) }}</b>
        <span class="sep">‚Ä¢</span>
        Energy: <b>{{ energyLabel(todayEnergy) }}</b>
      </div>
    </div>

    <div class="h-actions">
      <button class="icon-btn" type="button" (click)="goMood()" aria-label="Mood">‚ò∫Ô∏è</button>
      <button class="icon-btn" type="button" (click)="goProfile()" aria-label="Profile">üë©üèª</button>
      <button class="logout-btn" type="button" (click)="logout()">Logout</button>
    </div>
  </header>

  <section class="stats glass" [class.dim]="expandedLane">
    <button class="stat" type="button" (click)="openStatus('ALL')" [class.active]="statusFilter==='ALL'">
      <div class="k">All</div>
      <div class="v">{{ tasks.length }}</div>
    </button>

    <button class="stat" type="button" (click)="openStatus('PENDING')" [class.active]="statusFilter==='PENDING'">
      <div class="k">Pending</div>
      <div class="v">{{ pendingCount }}</div>
    </button>

    <button class="stat" type="button" (click)="openStatus('IN_PROGRESS')" [class.active]="statusFilter==='IN_PROGRESS'">
      <div class="k">In progress</div>
      <div class="v">{{ inProgressCount }}</div>
    </button>

    <button class="stat" type="button" (click)="openStatus('COMPLETED')" [class.active]="statusFilter==='COMPLETED'">
      <div class="k">Completed</div>
      <div class="v">{{ completedCount }}</div>
    </button>

    <div class="state" *ngIf="loading">Loading‚Ä¶</div>
    <div class="state err" *ngIf="error">{{ error }}</div>
  </section>

  <section class="lanes" [class.dim]="expandedLane">
    <button class="lane-card glass high" type="button" (click)="openLane('HIGH')">
      <div class="lh">
        <div class="t">High energy</div>
        <div class="pill">{{ highTasks.length }}</div>
      </div>
      <div class="d muted">Deep focus tasks</div>
      <div class="hint">Tap to view</div>
    </button>

    <button class="lane-card glass med" type="button" (click)="openLane('MEDIUM')">
      <div class="lh">
        <div class="t">Medium energy</div>
        <div class="pill">{{ mediumTasks.length }}</div>
      </div>
      <div class="d muted">Balanced tasks</div>
      <div class="hint">Tap to view</div>
    </button>

    <button class="lane-card glass low" type="button" (click)="openLane('LOW')">
      <div class="lh">
        <div class="t">Low energy</div>
        <div class="pill">{{ lowTasks.length }}</div>
      </div>
      <div class="d muted">Light tasks</div>
      <div class="hint">Tap to view</div>
    </button>
  </section>

 
  <button class="fab" type="button" (click)="goAddTask()" aria-label="Add task">+</button>

  <button class="fab-ai" type="button" (click)="openChatGPT()" aria-label="Open ChatGPT">
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="22" viewBox="0 0 30 30" aria-hidden="true">
      <path d="M 14.070312 2 C 11.330615 2 8.9844456 3.7162572 8.0390625 6.1269531 C 6.061324 6.3911222 4.2941948 7.5446684 3.2773438 9.3066406 C 1.9078196 11.678948 2.2198602 14.567816 3.8339844 16.591797 C 3.0745422 18.436097 3.1891418 20.543674 4.2050781 22.304688 C 5.5751778 24.677992 8.2359331 25.852135 10.796875 25.464844 C 12.014412 27.045167 13.895916 28 15.929688 28 C 18.669385 28 21.015554 26.283743 21.960938 23.873047 C 23.938676 23.608878 25.705805 22.455332 26.722656 20.693359 C 28.09218 18.321052 27.78014 15.432184 26.166016 13.408203 C 26.925458 11.563903 26.810858 9.4563257 25.794922 7.6953125 C 24.424822 5.3220082 21.764067 4.1478652 19.203125 4.5351562 C 17.985588 2.9548328 16.104084 2 14.070312 2 z"></path>
    </svg>
  </button>

 
  <div class="backdrop" *ngIf="expandedLane" (click)="closeLane()"></div>

  <div class="modal glass" *ngIf="expandedLane" (click)="$event.stopPropagation()">
    <div class="m-head">
      <div class="m-title">{{ activeLaneTitle }}</div>
      <button class="x" type="button" (click)="closeLane()" aria-label="Close">‚úï</button>
    </div>

    <div class="m-sub muted">
      {{ activeLaneCount }} task{{ activeLaneCount === 1 ? '' : 's' }} ‚Ä¢ filtered: <b>{{ statusFilter }}</b>
      <span class="sep">‚Ä¢</span>
      <span class="muted">Tip: click the dot to cycle status</span>
    </div>

    <div class="m-body">
      <div class="empty" *ngIf="!activeTasks.length">No tasks here.</div>

      <div class="task" *ngFor="let t of activeTasks">
        <button
          class="dot-btn"
          type="button"
          (click)="onTaskClick(t, $event)"
          (dblclick)="onTaskDoubleClick(t, $event)"
          aria-label="Toggle status"
        >
          <span class="dot" [class.checked]="t.status === 'IN_PROGRESS'" [class.done]="t.status === 'COMPLETED'"></span>
        </button>

        <div class="t-main">
          <div class="t-title">{{ t.title }}</div>
          <div class="t-meta">
            {{ durationLabel(t.duration) }}
            <span class="sep">‚Ä¢</span>
            <span [ngClass]="statusPillClass(t.status)">{{ statusLabel(t.status) }}</span>
          </div>
        </div>

        <div class="t-actions">
          <button class="undo" type="button" (click)="undoLastStatus(t, $event)" aria-label="Undo">‚Ü∫</button>
          <button class="trash" type="button" (click)="deleteTask(t.id, $event)" aria-label="Delete">üóëÔ∏è</button>
        </div>
      </div>
    </div>
  </div>

 
  <div class="toast" *ngIf="toastOpen" aria-live="polite" (click)="closeToast()">
    <div class="toast-title">Notice</div>
    <div class="toast-msg">{{ toastText }}</div>
  </div>
</div>
